@model ChilLaxFrontEnd.Models.CartList
@{
    ViewData["Title"] = "list";
}
<style>
    .checkout-page{
        padding: 30px;
        width: 40%;
        min-width: 400px;
        margin: 60px auto;
        background: #bebad2;
    }
</style>
<div class="checkout-page">
<h2>訂單確認</h2>
<hr />
<div class="row">
    <div class="col-md-4">
            <form>
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label class="control-label">購買人</label>
                <p>@Model.MemberPick.MemberName</p>
            </div>
            <div class="form-group">
                <label class="control-label">總金額</label>
                <p>@Model.totoPrice</p>
            </div>
            <div class="form-group">
                <label for="OrderTotalPrice" class="control-label">寄送方式</label>
                <select name="OrderTotalPrice">
                    <option>宅配</option>
                </select>
            </div>
            <div class="form-group">
                <label for="OrderAddress" class="control-label">地址</label>
                <input name="OrderAddress" class="form-control" value="@Model.MemberPick.MemberAddress"/>
            </div>
            <div class="form-group">
                <label for="OrderNote" class="control-label">備註</label>
                <input name="OrderNote" class="form-control" />
            </div>
            <div class="form-group">
            <input type="button" value="送出訂單" class="btn btn-default" onClick="submitForm()" />
            </div>
        </form>
    </div>
</div>
</div>

<script>
    const baseAddress = "https://localhost:5000"

    function submitForm() {
        const inputAddress = document.querySelector('input[name="OrderAddress"]');
        const inputNote = document.querySelector('input[name="OrderNote"]');

        function formatDateTime(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        const now = new Date();
        const formattedTime = formatDateTime(now);

        const productorderJson = {
            OrderAddress: inputAddress.value,
            OrderNote: inputNote.value,
            OrderDate: formattedTime
        };

        $.ajax({
            type: "POST",
            url: `${baseAddress}/api/CartsAPI/SaveProductOrder`,
            data: JSON.stringify(productorderJson),
            contentType: "application/json; charset=utf-8",
            dataType: "text",
            success: function (response) {
                // 在此处处理后端返回的 response 值
                console.log(response); // 可以在控制台输出 response
                // 将 response 插入到 HTML 页面的指定位置
                $('#targetElement').html(response); // 例如，假设目标元素的 ID 是 "targetElement"
                const targetUrl = `${baseAddress}/checkout/Index`;
                window.location.href = targetUrl;
            },
            error: function (xhr, status, error) {
                //alert(error);
            }
        });
    }
</script>
